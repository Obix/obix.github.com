<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Step 4: Creating a web interface to manage tasks</title><link rel="stylesheet" href="obix_doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="index.html" title="Obix programming language documentation"><link rel="up" href="CRUD_application.html" title="Chapter 1. Creating a web application with data stored in a database"><link rel="prev" href="CRUD_task_persistence.html" title="Step 3: Adding persistence to store objects in a database"><link rel="next" href="CRUD_task_DBI.html" title="Bonus 1: Adding a web interface to directly manipulate database tables"><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-29648172-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Step 4: Creating a web interface to manage tasks</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="CRUD_task_persistence.html"><img src="images/prev.png" alt="Previous chapter" title="Previous chapter"></a> </td><th width="60%" align="center">Chapter 1. Creating a web application with data stored in a database</th><td width="20%" align="right"> <a accesskey="n" href="CRUD_task_DBI.html"><img src="images/next.png" alt="Next chapter" title="Next chapter"></a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="CRUD_task_web_interface"></a>Step 4: Creating a web interface to manage tasks</h2></div></div></div><p>Now that we have an application that allows us to create, retrieve, update and delete tasks in a to-do list, the next step is to develop a web application so that users can manage tasks in a user-friendly way.</p><p>We could use Obix's integrated web server (or a webserver such as Tomcat or Jetty) and hand-code a web application composed of HTML, Javascript and CSS. But this is painful, so we won't do it.</p><p>We could also write a web application based on Java's <a href="http://en.wikipedia.org/wiki/Java_Servlet" target="_top">servlet</a> / <a href="http://en.wikipedia.org/wiki/JavaServer_Pages" target="_top">JSP</a> technology, as explained <a href="web_application.html" title="Developing a web application">later</a> in this tutorial. This would allow us to use any existing Java web development framework and combine it with Javascript libraries for client-side code.</p><p>Alternatively we can use the <em class="firstterm">Practical Application Input/Output Framework (PAIOF)</em>. <span class="emphasis"><em>PAIOF</em></span> is a framework written in Obix and embedded as a standard component of the Obix distribution. It is currently in a <a href="http://en.wikipedia.org/wiki/Proof_of_concept" target="_top">proof of concept</a>/<a href="http://en.wikipedia.org/wiki/Prototype" target="_top">prototype</a> state. As you will see shortly, the undeniable advantage is that it makes it extremely easy to write a <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete" target="_top">CRUD</a> application (and much more, as we'll see later).</p><p>The basic idea of PAIOF is that an application, seen from the outside, is composed of a set of commands which can be executed in many different ways. When you write an application that uses PAIOF, you are responsible for providing the commands you want to expose to the public; PAIOF takes care of executing these commands (in many different ways). In our example the application is made up of four commands (create, retrieve, update and delete) and we will use PAIOF to provide a web interface for these commands. Don't worry if this sounds a bit abstract. The focus of this chapter is just to <span class="emphasis"><em>use</em></span> PAIOF; you will later learn more about the concepts and how you can use PAIOF in a customized way to meet your requirements.</p><p>Because PAIOF executes commands, we have to provide the list of commands that PAIOF has to take care of. The good news is that these commands are there already! When you added <code class="code">persistence:JPA</code> in type <code class="code">task</code>, the compiler created a service called <code class="code">task_store</code>, as seen in the previous chapter. Besides this service, another service has been created. It is named <code class="code">task_commands</code> and stored in file <code class="code">se_task_commands.osc</code>. It contains the commands we will expose to the public via a web interface. If you open this source code file, you will see commands such as <code class="code">create_task</code>, <code class="code">show_task</code>, and so on. You could adapt these commands or add new commands, but in this exercise we will just stick with the default version.</p><p>The only thing we have to do is to start PAIOF when the application starts, and tell PAIOF to use all the commands in service <code class="code">task_commands</code>.</p><p>This is easy to do:</p><div class="itemizedlist"><ul type="disc"><li><p>Open file <code class="code">se_to_do_list_starter.osc</code>, located in subdirectory <code class="code">work/obix/source_code/to_do_list/</code> of your project directory. As you can guess from the file's name, this file represents the application's entry point. Whenever the application is launched, service <code class="code">to_do_list_starter</code> is loaded and then its <code class="code">start</code> command is executed.</p></li><li><p>Modify <code class="code">se_to_do_list_starter.osc</code> so that it looks as follows, then save the file:</p><pre class="programlisting">service to_do_list_starter

   command start
      in command_line_arguments type:indexed_string_list voidable:yes end
      
      script
         se_PAIOF.start_for_service_commands_by_regex ( &amp;
            command_line_arguments = i_command_line_arguments &amp;
            service_command_path_regex = fa_regex.create ( ".*se_task_commands.*"~ ) )
      end
   end				

end</pre><p>As you can see we just need to provide the identifier of service <code class="code">task_commands</code> (expressed as a regular expression) to PAIOF. In this case PAIOF will use all the commands it finds in <code class="code">se_task_commands.osc</code>.</p></li><li><p>Compile and build your project again</p></li></ul></div><p>Done!</p><p>You have created a web application.</p><p>To start a web server and see the web interface in action:</p><div class="itemizedlist"><ul type="disc"><li><p>Open a system terminal in your project's root directory and type:</p><pre class="programlisting">run @start_web_server</pre><p>or simply:</p><pre class="programlisting">run @sws</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">You can specify a different port for the web server with the <code class="code">@port</code> parameter. To use port 8080, for example, you would type:
					<pre class="programlisting">obix @sws @port:8080</pre></td></tr></table></div></li><li><p>Open a web browser and enter the URL displayed in your system terminal, e.g.</p><pre class="programlisting">http://127.0.0.1/</pre></li><li><p>In the drop down list box displayed at the top of your browser select <code class="code">create task</code></p></li><li><p>Enter some data. Your screen should look like this:</p><div class="figure"><a name="create_task_CRUD_example_2"></a><p class="title"><b>Figure 1.3. Create task web interface</b></p><div class="figure-contents"><div class="mediaobject"><img src="create_task_CRUD_example_2.jpg" alt="Create task web interface"></div></div></div><br class="figure-break"></li><li><p>Click the <code class="code">Create task</code> button. The newly created task will be displayed in the <code class="code">Output</code> section.</p></li><li><p>Enter a few more tasks. Then play around with the other commands to list, modify or delete tasks.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you execute command <code class="code">show_task_list</code> then the values entered in the fields <code class="code">Where clause</code> and <code class="code">Order by clause</code> must conform to the <a href="http://en.wikipedia.org/wiki/Java_Persistence_Query_Language" target="_top">Java Persistence Query Language</a>, which is an SQL-like, portable syntax that works regardless of the underlying database used.</p><p>For example, if you want to see only tasks remaining to be done you can enter:</p><pre class="programlisting">done = false</pre><p>in field <code class="code">Where clause</code></p><p>If you want to sort the list by priority, then by most recent entries first, you can enter the following <code class="code">Order by clause</code>:</p><pre class="programlisting">priority asc, time_created desc</pre></td></tr></table></div></li></ul></div><p>Important note: When you stop the PAIOF web server and start it again, all the data you entered previously are <span class="emphasis"><em>lost</em></span>. No reason to panic! This is a feature, not a bug. It is due to the fact that each time JPA starts, the database tables are created anew, thus deleting previous versions. The reason for this behavior is that during development, the structures of your data typically change often. By re-creating the database tables each time the application is re-started (based on the structure of the types defined in your Obix project) it is ensured that you always start with a clean set of tables corresponding to the latest data structures defined in your source code. You can change this behavior by changing the value of property <code class="code">hibernate.hbm2ddl.auto</code> in file <code class="code">work/java/META-INF/persistence.xml</code>. The default value for this property is <code class="code">create-drop</code>, which leads to the aforementioned behavior (hint: it is probably a good idea to set it to another value in your customers' environments). Please search for <code class="code">hibernate.hbm2ddl.auto</code> on the internet to get more information.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="CRUD_task_persistence.html"><img src="images/prev.png" alt="Previous chapter" title="Previous chapter"></a> </td><td width="20%" align="center"><a accesskey="u" href="CRUD_application.html"><img src="images/up.png" alt="Go up one level" title="Go up one level"></a></td><td width="40%" align="right"> <a accesskey="n" href="CRUD_task_DBI.html"><img src="images/next.png" alt="Next chapter" title="Next chapter"></a></td></tr><tr><td width="40%" align="left" valign="top">Step 3: Adding persistence to store objects in a database </td><td width="20%" align="center"><a accesskey="h" href="index.html"><img src="images/home.png" alt="Table of contents" title="Table of contents"></a></td><td width="40%" align="right" valign="top"> Bonus 1: Adding a web interface to directly manipulate database tables</td></tr></table></div></body></html>
