<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Chapter 3. Simple example</title><link rel="stylesheet" href="obix_doc.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="index.html" title="Obix programming language documentation"><link rel="up" href="bk01pt01.html" title="Part I. Fundamental concepts"><link rel="prev" href="bk01pt01ch02s02.html" title="Libraries"><link rel="next" href="bk01pt02.html" title="Part II. Language basics"><script type="text/javascript">
        
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-22290805-1']);
          _gaq.push(['_trackPageview']);
        
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        
    </script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 3. Simple example</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="bk01pt01ch02s02.html">Prev</a> </td><th width="60%" align="center">Part I. Fundamental concepts</th><td width="20%" align="right"> <a accesskey="n" href="bk01pt02.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="basic_example"></a>Chapter 3. Simple example</h2></div></div></div><p>To see how Obix source code looks like, let's have a look at a very simple example. We didn't explain yet all elements used in the source code below, but the goal is to just get a first idea, without worrying about all the details.</p><p>Suppose we want to deal with products in an ERP application. Obviously, a first step is to define type <code class="code">product</code>. This is how we do it:</p><pre class="programlisting">type<a name="co_type"></a><img src="images/callouts/1.png" alt="1" border="0"> id : product<a name="co_type_id"></a><img src="images/callouts/2.png" alt="2" border="0">
   // instructions to define the type<a name="co_comment"></a><img src="images/callouts/3.png" alt="3" border="0">
end type<a name="co_end_type"></a><img src="images/callouts/4.png" alt="4" border="0"></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#co_type"><img src="images/callouts/1.png" alt="1" border="0"></a> <a href="#co_end_type"><img src="images/callouts/4.png" alt="4" border="0"></a> </td><td valign="top" align="left"><p>The definition of a type starts with the keyword <code class="code">type</code> and ends with <code class="code">end type</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Every software element is ended with the keyword <code class="code">end</code>, optionally followed by it's name. So, instead of <code class="code">end type</code> we can also simply write <code class="code">end</code></td></tr></table></div><p></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_type_id"><img src="images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>Our type's identifier is <code class="code">product</code>.</p><p><code class="code">id</code> is a <em class="firstterm">property</em> of the type. Every property is defined by the syntax <code class="code">property_name : property_value</code>. The spaces before and after the : are optional.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Instead of writing <code class="code">type id : product</code> we can also simply write <code class="code">type product</code></td></tr></table></div><p></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_comment"><img src="images/callouts/3.png" alt="3" border="0"></a> </td><td valign="top" align="left"><p>To increase readability, indentation (spaces or tabs) is used in front of instructions that are contained in an element.</p><p>One-line comments start with //.</p></td></tr></table></div><p>By applying the simplifications explained in the above notes, we can write the code in a more concise way:</p><pre class="programlisting">type product
   // instructions to define the type
end</pre><p>The next step is to add attribute <code class="code">identifier</code> that is used to uniquely identify the product:</p><pre class="programlisting">type product
   attribute<a name="co_attribute"></a><img src="images/callouts/1.png" alt="1" border="0"> identifier type:positive32<a name="co_attribute_type"></a><img src="images/callouts/2.png" alt="2" border="0"> end
end</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#co_attribute"><img src="images/callouts/1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>The definition of an attribute starts with the keyword <code class="code">attribute</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_attribute_type"><img src="images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>The type of attribute <code class="code">identifier</code> is <code class="code">positive32</code>, which means that the identifier can be any positive number (greater than 0) stored in 32 bits</p></td></tr></table></div><p>Let's add two more attributes:</p><pre class="programlisting">type product
   attribute identifier type:positive32 end
   attribute name type:string end
   attribute price_in_cents type:positive32 end
end</pre><p>If we want to convert the product to an XML string, we can add the following command:</p><pre class="programlisting">command convert_to_XML<a name="co_command_id"></a><img src="images/callouts/1.png" alt="1" border="0">
   out result type:string end<a name="co_out"></a><img src="images/callouts/2.png" alt="2" border="0">
end</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#co_command_id"><img src="images/callouts/1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>The command's identifier is <code class="code">convert_to_XML</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_out"><img src="images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>The command's result is stored in output argument <code class="code">result</code> of type <code class="code">string</code></p></td></tr></table></div><p>The final code for type <code class="code">product</code> now becomes:</p><div class="example"><a name="simple_type_product_example"></a><p class="title"><b>Example 3.1. Simple example of type <code class="code">product</code></b></p><div class="example-contents"><pre class="programlisting">type product

   attribute identifier type:positive32 end
   attribute name type:string end
   attribute price_in_cents type:positive32 end
   
   command convert_to_XML
      out result type:string end
   end

end</pre></div></div><br class="example-break"><p>That's all for the type. As objects are created by factories, let's start defining a factory that will be used to create products:</p><pre class="programlisting">factory<a name="co_factory_keyword"></a><img src="images/callouts/1.png" alt="1" border="0"> product_factory<a name="co_factory_id"></a><img src="images/callouts/2.png" alt="2" border="0"> type: product<a name="co_factory_type"></a><img src="images/callouts/3.png" alt="3" border="0">
end factory</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#co_factory_keyword"><img src="images/callouts/1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>A factory starts with the keyword <code class="code">factory</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_factory_id"><img src="images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>The factory's identifier is <code class="code">product_factory</code></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_factory_type"><img src="images/callouts/3.png" alt="3" border="0"></a> </td><td valign="top" align="left"><p>The factory implements type <code class="code">product</code></p></td></tr></table></div><p>Each factory must have at least one creator. We will use a standard creator that enables us to specify values for all attributes:</p><pre class="programlisting">factory product_factory type: product
   creator<a name="co_creator_keyword"></a><img src="images/callouts/1.png" alt="1" border="0"> create<a name="co_creator_id"></a><img src="images/callouts/2.png" alt="2" border="0"> kind:in_all<a name="co_creator_kind"></a><img src="images/callouts/3.png" alt="3" border="0"> end
end factory</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#co_creator_keyword"><img src="images/callouts/1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>A creator starts with the keyword <code class="code">creator</code>.</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_creator_id"><img src="images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>The creator's identifier is <code class="code">create</code></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_creator_kind"><img src="images/callouts/3.png" alt="3" border="0"></a> </td><td valign="top" align="left"><p>By specifying <code class="code">kind:in_all</code> the compiler will automatically generate a creator with one input argument for each attribute defined in the type. See <a href="bk01pt02ch06s03.html" title="Creator">the section called &#8220;Creator&#8221;</a> for more information.</p></td></tr></table></div><p>A factory must define an implementation for each feature defined in the implemented type. However, the compiler generates a default implementation for each attribute if no explicit implementation is defined in the factory's source code. Hence, we don't have to code something for the attributes.</p><p><a name="simple_example_co_convert_to_XML"></a>But a command's implementation must always be coded explicitly. In our case, command <code class="code">convert_to_XML</code> could be implemented as follows:</p><pre class="programlisting">   command convert_to_XML
      script<a name="co_script_start"></a><img src="images/callouts/1.png" alt="1" border="0">
         result<a name="co_result_id"></a><img src="images/callouts/2.png" alt="2" border="0"> = """<a name="co_string_start"></a><img src="images/callouts/3.png" alt="3" border="0">
           &lt;product&gt;
             &lt;id&gt;{{<a name="co_embedded_start"></a><img src="images/callouts/4.png" alt="4" border="0">identifier.to_string<a name="co_embedded"></a><img src="images/callouts/5.png" alt="5" border="0">}}<a name="co_embedded_end"></a><img src="images/callouts/6.png" alt="6" border="0">&lt;/id&gt;
             &lt;name&gt;{{name}}<a name="co_another_embedded"></a><img src="images/callouts/7.png" alt="7" border="0">&lt;/name&gt;
             &lt;price_in_cents&gt;{{price_in_cents.to_string}}&lt;/price_in_cents&gt;
           &lt;/product&gt;"""<a name="co_string_end"></a><img src="images/callouts/8.png" alt="8" border="0">
      end script
   end command</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#co_script_start"><img src="images/callouts/1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>start of the script that implements command <code class="code">convert_to_XML</code></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_result_id"><img src="images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>the result is stored in output argument <code class="code">result</code></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_string_start"><img src="images/callouts/3.png" alt="3" border="0"></a> </td><td valign="top" align="left"><p>start of a triple quoted string (for more information see <a href="bk01pt02ch04s05.html#triple_quoted_string_literal" title="Triple quoted string literal">the section called &#8220;Triple quoted string literal&#8221;</a>)</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_embedded_start"><img src="images/callouts/4.png" alt="4" border="0"></a> </td><td valign="top" align="left"><p>start of an expression embedded in the string</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_embedded"><img src="images/callouts/5.png" alt="5" border="0"></a> </td><td valign="top" align="left"><p><code class="code">identifier.to_string</code> is an expression embedded in the string (attribute <code class="code">identifier</code> of type <code class="code">positive32</code> is converted to type <code class="code">string</code>)</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_embedded_end"><img src="images/callouts/6.png" alt="6" border="0"></a> </td><td valign="top" align="left"><p>end of an expression embedded in the string</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_another_embedded"><img src="images/callouts/7.png" alt="7" border="0"></a> </td><td valign="top" align="left"><p>another embedded expression</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_string_end"><img src="images/callouts/8.png" alt="8" border="0"></a> </td><td valign="top" align="left"><p>end of triple quoted string</p></td></tr></table></div><p>The complete code for factory <code class="code">product_factory</code> is:</p><div class="example"><a name="simple_factory_product_example"></a><p class="title"><b>Example 3.2. Simple example of factory <code class="code">product</code></b></p><div class="example-contents"><pre class="programlisting">factory product_factory type: product

   command convert_to_XML
      script
         result = """
           &lt;product&gt;
             &lt;id&gt;{{identifier.to_string}}&lt;/id&gt;
             &lt;name&gt;{{name}}&lt;/name&gt;
             &lt;price_in_cents&gt;{{price_in_cents.to_string}}&lt;/price_in_cents&gt;
           &lt;/product&gt;"""
      end script
   end command

   creator create kind:in_all end

end factory</pre></div></div><br class="example-break"><p>Now an object of type <code class="code">product</code> can be created as follows:</p><pre class="programlisting">var product banana<a name="co_variable"></a><img src="images/callouts/1.png" alt="1" border="0"> =<a name="co_assignment_operator"></a><img src="images/callouts/2.png" alt="2" border="0"> product_factory.create<a name="co_creator"></a><img src="images/callouts/3.png" alt="3" border="0"> ( &amp;<a name="co_line_continuation"></a><img src="images/callouts/4.png" alt="4" border="0">
   identifier = 123<a name="co_assign_identifier"></a><img src="images/callouts/5.png" alt="5" border="0"> &amp;
   name = "banana"<a name="co_assign_name"></a><img src="images/callouts/6.png" alt="6" border="0"> &amp;
   price_in_cents = 20<a name="co_assign_price_in_cents"></a><img src="images/callouts/7.png" alt="7" border="0"> )</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#co_variable"><img src="images/callouts/1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>declare variable <code class="code">banana</code> of type <code class="code">product</code></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_assignment_operator"><img src="images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>assignment operator</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_creator"><img src="images/callouts/3.png" alt="3" border="0"></a> </td><td valign="top" align="left"><p>use creator <code class="code">create</code> of factory <code class="code">product_factory</code> to create an object of type <code class="code">product</code></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_line_continuation"><img src="images/callouts/4.png" alt="4" border="0"></a> </td><td valign="top" align="left"><p>&amp; is the 'line continuation character' in Obix. (see <a href="bk01pt02ch04s04.html" title="Line continuation">the section called &#8220;Line continuation&#8221;</a>) </p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_assign_identifier"><img src="images/callouts/5.png" alt="5" border="0"></a> </td><td valign="top" align="left"><p>assign the value <code class="code">123</code> to input argument <code class="code">identifier</code></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_assign_name"><img src="images/callouts/6.png" alt="6" border="0"></a> </td><td valign="top" align="left"><p>assign <code class="code">"banana"</code> to input argument <code class="code">name</code></p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_assign_price_in_cents"><img src="images/callouts/7.png" alt="7" border="0"></a> </td><td valign="top" align="left"><p>assign <code class="code">20</code> to input argument <code class="code">price_in_cents</code></p></td></tr></table></div><p>To display an XML representation of the banana on the system console, we can write:</p><pre class="programlisting">system.console.write_line<a name="co_write_line"></a><img src="images/callouts/1.png" alt="1" border="0"> ( banana.convert_to_XML<a name="co_convert_to_XML"></a><img src="images/callouts/2.png" alt="2" border="0"> )</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><a href="#co_write_line"><img src="images/callouts/1.png" alt="1" border="0"></a> </td><td valign="top" align="left"><p>use command <code class="code">write_line</code> of the system's console (<code class="code">system.console</code>) to display a message</p></td></tr><tr><td width="5%" valign="top" align="left"><a href="#co_convert_to_XML"><img src="images/callouts/2.png" alt="2" border="0"></a> </td><td valign="top" align="left"><p>execute command <code class="code">convert_to_XML</code> on the object stored in variable <code class="code">banana</code></p></td></tr></table></div><p>We can embed the above instructions in a service, as follows:</p><pre class="programlisting">service product_tests

   command display_banana_XML
      script
         var product banana = product_factory.create ( &amp;
            identifier = 123 &amp;
            name = "banana" &amp;
            price_in_cents = 20 )
         system.console.write_line ( banana.convert_to_XML )
      end script
   end command

end service</pre><p>Executing <code class="code">product_tests.display_banana_XML</code> will display the following:</p><pre class="screen">           &lt;product&gt;
             &lt;id&gt;123&lt;/id&gt;
             &lt;name&gt;banana&lt;/name&gt;
             &lt;price_in_cents&gt;20&lt;/price_in_cents&gt;
           &lt;/product&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">The above example is written without using prefixed identifiers. Those are optional and they will be explained in <a href="bk01pt02ch04s02s02.html" title="Prefixed identifier">the section called &#8220;Prefixed identifier&#8221;</a>.</td></tr></table></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="bk01pt01ch02s02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="bk01pt01.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="bk01pt02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Libraries </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Part II. Language basics</td></tr></table></div></body></html>
